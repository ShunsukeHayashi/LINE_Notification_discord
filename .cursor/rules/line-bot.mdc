---
description: 
globs: 
---


<cNE Bot Configuration Rules"/>

â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢
LINEãƒœãƒƒãƒˆç”¨ã®è¨­å®šãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢

<Plan>
LINE Botã®è¨­å®šã€ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã«é–¢ã™ã‚‹åŒ…æ‹¬çš„ãªãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
</Plan>

```xml
<file path=".cursor/rules/line-bot.mdc" action="create">
  <change>
    <description>Create LINE Bot configuration and rules</description>
    <content>
===
# LINE Bot Configuration Rules ğŸ¤–

## åŸºæœ¬è¨­å®š

### ãƒãƒ£ãƒãƒ«è¨­å®š
```yaml
channel:
  name: ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥Bot
  type: Messaging API
  provider: LINE
  features:
    - webhook
    - push_message
    - quick_reply
    - flex_message
```

### ç’°å¢ƒå¤‰æ•°
```yaml
environment:
  required:
    - LINE_CHANNEL_SECRET
    - LINE_CHANNEL_ACCESS_TOKEN
    - SUPABASE_URL
    - SUPABASE_KEY
  optional:
    - LINE_BOT_API_ENDPOINT
    - WEBHOOK_URL
```

## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°è¦å‰‡

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå®šç¾©
```yaml
message_templates:
  event_notification:
    type: flex
    structure:
      header:
        type: box
        layout: vertical
        contents:
          - type: text
            text: ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥
            weight: bold
      body:
        type: box
        layout: vertical
        contents:
          - type: text
            text: {event_title}
          - type: text
            text: {event_datetime}
          - type: text
            text: {event_location}
      footer:
        type: box
        layout: vertical
        contents:
          - type: button
            action:
              type: postback
              label: å‚åŠ ã™ã‚‹
              data: join_{event_id}
```

### ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ—ãƒ©ã‚¤è¨­å®š
```yaml
quick_replies:
  event_actions:
    - label: ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
      text: !events
    - label: å‚åŠ ä¸­ã‚¤ãƒ™ãƒ³ãƒˆ
      text: !myevents
    - label: ãƒ˜ãƒ«ãƒ—
      text: !help
```

## ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### Webhookã‚¤ãƒ™ãƒ³ãƒˆ
```yaml
webhook_events:
  - type: message
    handlers:
      - MessageHandler
  - type: postback
    handlers:
      - PostbackHandler
  - type: follow
    handlers:
      - FollowHandler
  - type: unfollow
    handlers:
      - UnfollowHandler
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
```yaml
error_handling:
  retry:
    max_attempts: 3
    delay: 1000
  notifications:
    admin_line_id: "U1234567890abcdef"
    error_levels:
      - critical
      - warning
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº

### ãƒ†ãƒ¼ãƒ–ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°
```yaml
database_mapping:
  line_users:
    table: users
    fields:
      - line_user_id
      - display_name
      - status
  user_preferences:
    table: user_preferences
    fields:
      - user_id
      - notification_enabled
      - language
```

### ã‚¯ã‚¨ãƒªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```yaml
query_templates:
  get_user_events:
    table: participants
    join:
      - events
    where:
      user_id: {user_id}
      status: active
```

## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒ­ãƒ¼

### ã‚³ãƒãƒ³ãƒ‰å‡¦ç†
```yaml
commands:
  prefix: "!"
  handlers:
    events:
      - description: ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã‚’è¡¨ç¤º
      - permissions: []
    myevents:
      - description: å‚åŠ ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¡¨ç¤º
      - permissions: [authenticated]
    join:
      - description: ã‚¤ãƒ™ãƒ³ãƒˆã«å‚åŠ 
      - permissions: [authenticated]
    leave:
      - description: ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰é›¢è„±
      - permissions: [authenticated]
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
```yaml
response_formats:
  event_list:
    type: carousel
    max_items: 10
    item_template:
      title: {event_name}
      description: {event_description}
      action: postback
      data: view_event_{event_id}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

### èªè¨¼è¦å‰‡
```yaml
authentication:
  required: true
  methods:
    - line_login
  session:
    timeout: 3600
    refresh: true
```

### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
```yaml
access_control:
  roles:
    - user
    - admin
  permissions:
    user:
      - view_events
      - join_events
      - leave_events
    admin:
      - create_events
      - modify_events
      - delete_events
```

## ãƒ†ã‚¹ãƒˆè¦å‰‡

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¦ä»¶
```yaml
unit_tests:
  coverage:
    minimum: 80%
  required_tests:
    - message_handling
    - event_processing
    - database_operations
```

### çµ±åˆãƒ†ã‚¹ãƒˆè¦ä»¶
```yaml
integration_tests:
  required_scenarios:
    - full_event_flow
    - user_registration
    - notification_delivery
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“
```yaml
response_times:
  webhook: 1000ms
  message_processing: 500ms
  database_query: 100ms
```

### ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°
```yaml
throttling:
  message_rate: 30/minute
  user_rate: 5/minute
```

## ç›£è¦–è¨­å®š

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹
```yaml
metrics:
  collect:
    - message_count
    - response_time
    - error_rate
    - user_engagement
```

### ã‚¢ãƒ©ãƒ¼ãƒˆ
```yaml
alerts:
  error_rate:
    threshold: 5%
    window: 5m
  response_time:
    threshold: 2000ms
    window: 1m
```

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

### ã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆ
```typescript
/**
 * @handler MessageHandler
 * @event message
 * @description ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†ã™ã‚‹
 * @param {MessageEvent} event - LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆ
 * @returns {Promise<void>}
 */
```

### APIä»•æ§˜
```yaml
api_documentation:
  format: OpenAPI
  version: 3.0.0
  required_sections:
    - endpoints
    - schemas
    - security
```

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†

### æ›´æ–°å±¥æ­´
```yaml
version_history:
  1.0.0:
    date: 2024-01-20
    changes:
      - åˆæœŸå®Ÿè£…
      - åŸºæœ¬æ©Ÿèƒ½ã®å®Ÿè£…
      - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã®å®Ÿè£…
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ«ãƒ¼ãƒ«
```yaml
deployment:
  strategy: rolling
  environments:
    - development
    - staging
    - production
  checks:
    - test_coverage
    - security_scan
    - performance_test
```
===
    </content>
  </change>
</file>
```

â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢
ã“ã®LINE Botãƒ«ãƒ¼ãƒ«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

1. ãƒãƒ£ãƒãƒ«è¨­å®šã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ãƒ«ãƒ¼ãƒ«
2. ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºã¨ã‚¯ã‚¨ãƒªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
5. ãƒ†ã‚¹ãƒˆã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–
6. ç›£è¦–ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

å¿…è¦ã«å¿œã˜ã¦ä»¥ä¸‹ã®æ‹¡å¼µãŒå¯èƒ½ã§ã™ï¼š
- ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- è¿½åŠ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
- æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢